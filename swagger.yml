openapi: 3.0.3
info:
  title: News Aggregator API
  version: 1.0.0
  description: |
    HTTP API for retrieving summarised and reranked news reports generated by the
    News Aggregator service.
servers:
  - url: http://localhost:8080
    description: Local development server
paths:
  /news:
    post:
      summary: Fetch top news reports for the requested topics
      operationId: fetchNews
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RankingRequest'
            examples:
              default:
                value:
                  topics:
                    - inflation
                    - bank earnings
                  top_n: 5
      responses:
        '200':
          description: A list of news reports sorted by relevance to the requested topics
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ReportResponse'
        '400':
          description: Invalid request payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /reports/rebuild:
    post:
      summary: Trigger rebuilding the cached reports
      operationId: rebuildReports
      responses:
        '200':
          description: Total number of reports available after rebuild
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RebuildResponse'
components:
  schemas:
    RankingRequest:
      type: object
      required:
        - topics
        - top_n
      properties:
        topics:
          type: array
          description: List of topics to rank news against
          minItems: 1
          items:
            type: string
        top_n:
          type: integer
          description: Number of top articles to return
          minimum: 1
    ReportResponse:
      type: object
      required:
        - agency
        - summary
        - url
        - published_at
        - crawled_at
      properties:
        agency:
          type: string
          description: Identifier of the publishing agency
        title:
          type: string
          nullable: true
          description: Article headline if available
        summary:
          type: string
          description: LLM-generated summary of the article
        image_base64:
          type: string
          nullable: true
          description: Base64-encoded lead image for the article
        url:
          type: string
          format: uri
          description: Canonical URL of the article
        published_at:
          type: string
          format: date-time
          description: Publication timestamp reported by the source feed
        crawled_at:
          type: string
          format: date-time
          description: Timestamp when the article was ingested by the service
    RebuildResponse:
      type: object
      required:
        - rebuilt
      properties:
        rebuilt:
          type: integer
          description: Total number of reports available after a rebuild operation
          minimum: 0
    ErrorResponse:
      type: object
      required:
        - detail
      properties:
        detail:
          type: string
          description: Human-readable explanation of the validation error
